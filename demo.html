<html>
<head>
<title>merc extreme</title>

<script src="//cdnjs.cloudflare.com/ajax/libs/three.js/r66/three.min.js"></script>

<link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.css" />

<!--<script src="lib/three.js"></script>-->
<script src="lib/jquery-latest.min.js"></script>
<script src="lib/jquery-ui-1.10.4.custom.min.js"></script>
<script src="lib/underscore.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/knockout/3.1.0/knockout-min.js"></script>
<script src="merc-extreme.js"></script>
<script src="geodesy.js"></script>
<script src="coords-db.js"></script>

<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>

<script>

$(document).ready(init);

</script>

</head>
<body>

<style>

body {
  margin: 0;
  height: 100%;
  overflow: hidden;
  font-family: sans-serif;
}

#titlebar {
  background: #222;
  border-bottom: 1px solid black;
}

.dropdown {
  color: white;
  position: absolute;
  top: 100%;
  right: 0;
  background: rgba(0, 0, 0, .4);
  z-index: 500;
  display: none;
  width: 15em;
  padding: 15px;
  border-radius: 0 0 10px 10px;
}

.dropdown-anchor:hover > .dropdown {
  display: block;
}

input {
  margin: 0;
}

</style>

<div id="titlebar" style="color: white; padding: 5px;">
  MERCATOR: EXTREME by Drew Roos
  <div style="float: right;">
    <form id="search" style="display: inline-block; margin: 0; margin-right: 60px;">
      <input id="locsearch" placeholder="change origin to&hellip;"></input>
      <input type="submit" value="Go"></input>
    </form>
    <div class="dropdown-anchor" style="display: inline-block; position: relative;">Layers
      <div id="layers" class="dropdown">
        <div data-bind="foreach: layers">
          <div data-bind="click: $parent.selectLayer">
            <span data-bind="text: displayName, style: { color: active() ? '#faa' : '' }"></span>
            <span data-bind="if: custom() && !pending(), click: edit">(edit)</span>
            <span data-bind="if: custom, click: $parent.removeLayer">(remove)</span>
            <div data-bind="template: {name: 'layer-edit', data: editContext, if: pending}"></div>
          </div>
        </div>
        <div data-bind="if: !pendingLayer(), click: newPendingLayer">new layer</div>
        <div data-bind="template: {name: 'layer-edit', data: editContext, if: pendingLayer}">
        </div>
      </div>
    </div>
    <div id="companion" style="display: inline-block;">Companion Map</div>
    <div class="dropdown-anchor" style="display: inline-block; position: relative;">Landmarks
      <div class="dropdown" data-bind="foreach: places">
        <div data-bind="click: select">
          <div data-bind="text: name"></div>
          <div data-bind="html: byline" style="font-size: 70%; margin-left: 1em;"></div>
        </div>
      </div>
    </div>
    <div class="dropdown-anchor" style="display: inline-block; position: relative;">Settings
      <div class="dropdown" id="settings">
        Units: <span style="color: #faa;" data-bind="text: active_unit, click: toggleUnit"></span><br>
        Blending between zoom levels
        <div id="blend"></div>
        Overzoom
        <div id="overzoom"></div>
        Opacity of blinders
        <div id="blinders"></div>
      </div>
    </div>
    <div style="display: inline-block;">Help</div>
  </div>
  <div style="clear: both;"></div>
</div>

<div id="container" style="position: relative;">

<script type="text/html" id="layer-edit">
  <div data-bind="with: layer">
    url template <input data-bind="value: url"></input><br>
    <div style="display: none;">
      Enter the url template to load tiles from for this map layer. Use the
      following template variables:
      {z} - zoom level
      {x} - x coordinate
      {y} - y coordinate
      {s:...} - server shard (optional):
        {s:1-4} - use shards 1, 2, 3, 4
        {s:abc} - use shards a, b, c

      Example: http://tileserver{s:0-3}.maps-r-us.com/blah/blah/{z}/{x}/{y}.jpg

      The tile server must support cross-origin requests in order to be
      usable in extreme mercator. (This means the server must include the
      header "Access-Control-Allow-Origin: *" in its response).
    </div>
    name (opt) <input data-bind="value: name"></input><br>
    max depth (opt) <input data-bind="value: max_depth"></input><br>
    <div id="tile_preview">
      <div data-bind="if: preview_status() == 'loading'">loading...</div>
      <div data-bind="if: preview_status() == 'error'">could not load tile
        <div style="display: none;">
          This could be because:
          1) the url template is incorrect
          2) the tile server does not support cross-origin requests
          3) everything is in fact correct, but the map layer does not publish
             a tile at zoom level 0. (such map layers will probably not look good
             in an extreme mercator anyway -- layers that provide global coverage
             are best
        </div>
      </div>
      <div data-bind="if: preview_status() == 'success'">
        <img data-bind="attr: {src: preview_url}" />
      </div>
    </div>
  </div>
  <button data-bind="click: commit, text: commitCaption"></button>
  <button data-bind="click: cancel">cancel</button>
</script>

<div id="attribution" style="position: absolute; left: 0; right: 0; bottom: 0; text-align: center; pointer-events: none;"><span style="background: rgba(255, 255, 255, .4); display: inline-block; border-radius: 5px 5px 0 0; pointer-events: auto;" data-bind="html: curAttr"></span></div>
<div id="poleinfo" style="text-align: right; background: rgba(255, 255, 255, .4); position: absolute; right: 0; bottom: 0; border-radius: 5px 0 0 0;">
  POLE<br><span class="swap">&harr;</span><span class="data"></span>
</div>
<div id="antipoleinfo" style="background: rgba(255, 255, 255, .4); position: absolute; left: 0; bottom: 0; border-radius: 0 5px 0 0;">
  ANTI-POLE<br><span class="data"></span><span class="swap">&harr;</span>
</div>
<div id="mouseinfo" style="background: rgba(255, 255, 255, .4); position: absolute; left: 10px; top: 10px;">
  MOUSEPOS
  <div>
    <div id="pos"></div>
    <div id="dist"></div>
    <div id="bearing"></div>
    <div id="orient"><span style="display: inline-block;">&uarr;</span></div>
    <div id="scale"><span id="label"></span><div id="bar" style="height: 6px; background: rgba(0, 0, 0, .6);"></div></div>
  </div>
</div>

</div>

<div id="help" style="display: none;">

move map - click&amp;drag
zoom in - double-click
zoom in/out - scrollwheel

move pole point - shift+click&amp;drag or right-click&amp;drag
go to point - shift+double-click or double-right-click

</div>

</body>
</html>
