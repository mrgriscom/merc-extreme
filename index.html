<html>
<head>
<title>Mercator: Extreme</title>

<script src="//cdnjs.cloudflare.com/ajax/libs/three.js/r66/three.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/knockout/3.1.0/knockout-min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
<script src="lib/jquery-ui-1.10.4.custom.min.js"></script>
<script src="merc-extreme.js"></script>
<script src="geodesy.js"></script>

<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans+Condensed:300,700|Open+Sans:400" />

<script src="coords-db.js"></script>

<script>

$(document).ready(init);

</script>

</head>
<body>

<style>

body {
  margin: 0;
  height: 100%;
  overflow: hidden;
  font-family: sans-serif;
}

#titlebar {
  background: #222;
  border-bottom: 1px solid black;
  height: 30px;
}

.icon {
  padding: 3px;
}

.dropdown {
  color: white;
  position: absolute;
  top: 100%;
  right: -30px;
  background: rgba(0, 0, 0, .7);
  z-index: 500;
  display: none;
  min-width: 8em;
  padding: 15px;
  border-radius: 0 0 10px 10px;
}

.dropdown-anchor:hover > .dropdown {
  display: block;
}

.dropdownchoice:hover {
  background: rgba(255, 255, 255, .1);
}

input {
  margin: 0;
}

.swap {
  cursor: pointer;
  margin-top: -5px;
}

a {
  color: #058;
}
a:visited {
  color: #058;
}
a:hover {
  color: #07a;
}

#titlebar a {
  color: white;
  text-decoration: none;
}
#titlebar a:visited {
  color: white;
}
#titlebar a:hover {
  color: #def;
  text-decoration: underline;
}
#titlebar .dropdown a {
  text-decoration: underline;
}

.poleinfo {
  background: rgba(200, 200, 200, .7);
  position: absolute;
  bottom: 0;
  border-top: 2px solid rgba(100, 100, 100, .4);
  font-weight: bold;
  font-size: 14px;
  color: #222;
  padding: 3px;
}

.polehdr {
  font-size: 11px;
  color: #333;
}

.pole {
  text-align: right;
  right: 0;
  border-radius: 5px 0 0 0;
  border-left: 2px solid rgba(100, 100, 100, .4);
}

.antipole {
  left: 0;
  border-radius: 0 5px 0 0;
  border-right: 2px solid rgba(100, 100, 100, .4);
}

.pointerinfo {
  background: rgba(200, 200, 200, .7);
  position: absolute;
  top: 0;
  left: 0;
  border-bottom: 2px solid rgba(100, 100, 100, .4);
  border-right: 2px solid rgba(100, 100, 100, .4);
  border-radius: 0 0 5px 0;
  font-weight: bold;
  font-size: 14px;
  color: #222;
  padding: 3px;
}



.ui-slider-handle {
    cursor: default;
    position: absolute;
    width: 12px;
    height: 12px;
    background: -moz-linear-gradient(#4B4947, #32302D);
    background: -webkit-gradient(linear, left top, left bottom, from(#4B4947), to(#32302D));
    -moz-box-shadow: inset 0 1px 0 #5B5957, 0 -1px 0 black, 0 1px 0 black, -1px 0 0 black, 1px 0 0 black, 0 1px 1px #111;
    -webkit-box-shadow: inset 0 1px 0 #5B5957, 0 -1px 0 black, 0 1px 0 black, -1px 0 0 black, 1px 0 0 black, 0 1px 1px #111;
    margin: -6px;
    border-radius: 6px;
    -moz-border-radius: 7px;
    -webkit-border-radius: 7px;
}

.ui-state-active {
    background: -moz-linear-gradient(#6B6967, #42403D);
    background: -webkit-gradient(linear, left top, left bottom, from(#6B6967), to(#42403D));
}

.ui-state-focus {
    outline: none;
}

.ui-slider {
    position: relative;
    margin: 8px 0 0 0;
    border-top: 1px solid #222;
    border-bottom: 1px solid #555;
}

.slider-label {
  font-size: 11px;
  color: #aaa;
  font-weight: bold;
  text-transform: uppercase;
}

.slider-val {
  text-align: right;
  font-size: 14px;
  color: white;
  font-weight: bold;
  width: 3em;
}

.slider-ctrl {
  margin-top: 15px;
}

label {
  font-size: 11px;
  color: #aaa;
  font-weight: bold;
  text-transform: uppercase;
}

.layerform input {
  margin-bottom: .5em;
}

.layerform .help {
  font-size: 75%;
}

.ctrlkey {
  text-align: right;
  float: right;
  font-size: 11px;
  color: #aaa;
  font-weight: bold;
  text-transform: uppercase;
  margin-bottom: .3em;
}

.ctrllabel {
  font-size: 80%;
  font-family: "Open Sans", sans-serif;
}

h3 {
  font-family: "Open Sans", sans-serif;
}

#alerts p {
  font-size: 80%;
  margin: 1em 0;
}

</style>

<div id="titlebar" style="color: white;">
  <div class="dropdown-anchor" style="float: right; position: relative; margin-right: 30px;">
    <img class="icon" src="img/help.png" title="Help" />
    <div class="dropdown" style="width: 40em; text-align: left;" id="help">
      <h3>Controls</h3>
      <div style="width: 20em;">
        <div style="clear: both;">
          <div class="ctrlkey">drag</div>
          <div class="ctrllabel">pan around map</div>
        </div>
        <div style="clear: both;">
          <div class="ctrlkey">double-click</div>
          <div class="ctrllabel">zoom in</div>
        </div>
        <div style="clear: both;">
          <div class="ctrlkey">scrollwheel</div>
          <div class="ctrllabel">zoom in/out</div>
        </div>
        <div style="clear: both;">
          <div class="ctrlkey">
            shift+drag<br>
            right-click drag
          </div>
          <div class="ctrllabel">warp map (change origin point)</div>
        </div>
        <div style="clear: both;">
          <div class="ctrlkey">
            shift+double-click<br>
            right-double-click
          </div>
          <div class="ctrllabel">go to point</div>
        </div>
      </div>
      <h3>The Short Story</h3>
      <div style="font-size: 80%;">
        <p>
        This project is a visualization of the Mercator projection.
        But unlike most Mercator maps, this map cuts off much, much closer to the earth's poles.
        </p>

        <p>
        The map is shown sideways from its usual orientation for better viewing (that is, the poles are at the left and right edges, not the top and bottom).
        </p>
        
        <p>
        Furthermore, you can shift the pole of the projection to any point on earth, in order to see the Mercator's extreme distortion wrought on a familiar place.
        </p>
      </div>
      <h3>The Long Story</h3>
      <div style="font-size: 80%;">
        <p>
          The Mercator projection is infamous for its distortion as you approach the poles.
          It is in fact impossible to ever reach the poles on a Mercator map; they are infinitely far off.
          A typical Mercator map cuts off as the distortion gets too severe &mdash; hundreds if not thousands of miles short of the poles.
        </p>

        <p>
          But I've always wondered what it'd be like if we didn't cut off, and simply&hellip; kept going.
          As the distortion marches exponentially and infinitely onward, you'd eventually be on the scale of cities, houses, insects, atoms&hellip;
          But of course all this only for a featureless expanse of ice.
        </p>

        <p>
          To make things interesting, we can artificially shift the pole of the projection to a more familiar place instead.
          This is called an <em>oblique Mercator</em>, and already things start to look a little weird.
          -- familiar places subject to the same distortion that the polar regions are subjected to in the most popular map projection in the world.
        </p>





(show mercator projection, normal clip plane, normal orientation)

This is the ubiquitous Mercator projection.

Aesthetically pleasing for being both conformal (shape preserving) and cylindrical (grid preserving)...

...but reviled for its extreme distortion as you approach the poles.

(overlay distortion circles)

Distortion so extreme that the map cuts off hundreds, if not thousands of miles short of the pole.

But I've often wondered what I'd find if instead of cutting off, we simply... kept going.

...

Of course, we'd find a featureless expanse of ice.

First we must artificially shift the pole to a more familiar place.

(shift pole to new york)

If this looks weird, realize that this is the distortion the polar regions are subjected to in the most popular map projection in the world!

This kind of projection -- an oblique Mercator -- is not uncommon. But it is used to shift an area of interest into the zone of minimum distortion.

But whereas other try to minimize distortion, instead, we embrace it.

(tilt map horizontal, change clip boundaries to full extreme)

Let's take a moment to appreciate was we have here.
We have:
* a single map projection
* that shows the entire surface of the earth
* while traversing all the way from the human scale, to the global scale

To underscore this "center of the universe" feeling...
(new yorker cover comparison)

Interesting properties:

Vertical lines ("parallels") show rings of constant distance from the pole point.
the parallels can visualize remoteness
(move to st helena)

Horizontal lines ("meridians") show straight lines radiating out from the pole point in all directions. Meridians one map-width apart from each other represent _opposite_ directions.
the meridians can visualize central plazas and spokes
(move to arc du triomphe)

together, if we center on a major city, beltways become vertical frontiers and the highways look like a dendritic network to far-flung destinations
(move to atlanta, boston too?)

relatedly, it's an excellent way to visualize long-distance driving routes. generally such a route has many turns locally, a few arteries at intermediate distance, then long-distance highways. the extreme mercator seems to normalize scale vs distance in a very accessible way. you just have to turn your head inside out a bit

lastly, it's an excellent way to visualize antipodes -- points that are on the complete opposite sides of the earth from each other.
(move to spain/nz) -- these two buildings are directly opposite from eachother. when one is night, the other is always day, and vice versa.


        <p>I am already far north of London, and as I walk in the streets of Petersburgh, I feel a cold northern breeze play upon my cheeks, which braces my nerves and fills me with delight. Do you understand this feeling? This breeze, which has travelled from the regions towards which I am advancing, gives me a foretaste of those icy climes. Inspirited by this wind of promise, my daydreams become more fervent and vivid. I try in vain to be persuaded that the pole is the seat of frost and desolation; it ever presents itself to my imagination as the region of beauty and delight. There, Margaret, the sun is forever visible, its broad disk just skirting the horizon and diffusing a perpetual splendour. There—for with your leave, my sister, I will put some trust in preceding navigators—there snow and frost are banished; and, sailing over a calm sea, we may be wafted to a land surpassing in wonders and in beauty every region hitherto discovered on the habitable globe. Its productions and features may be without example, as the phenomena of the heavenly bodies undoubtedly are in those undiscovered solitudes. What may not be expected in a country of eternal light? I may there discover the wondrous power which attracts the needle and may regulate a thousand celestial observations that require only this voyage to render their seeming eccentricities consistent forever. I shall satiate my ardent curiosity with the sight of a part of the world never before visited, and may tread a land never before imprinted by the foot of man. These are my enticements, and they are sufficient to conquer all fear of danger or death and to induce me to commence this laborious voyage with the joy a child feels when he embarks in a little boat, with his holiday mates, on an expedition of discovery up his native river. But supposing all these conjectures to be false, you cannot contest the inestimable benefit which I shall confer on all mankind, to the last generation, by discovering a passage near the pole to those countries, to reach which at present so many months are requisite; or by ascertaining the secret of the magnet, which, if at all possible, can only be effected by an undertaking such as mine.

        <p>These reflections have dispelled the agitation with which I began my letter, and I feel my heart glow with an enthusiasm which elevates me to heaven, for nothing contributes so much to tranquillize the mind as a steady purpose—a point on which the soul may fix its intellectual eye. This expedition has been the favourite dream of my early years. I have read with ardour the accounts of the various voyages which have been made in the prospect of arriving at the North Pacific Ocean through the seas which surround the pole. You may remember that a history of all the voyages made for purposes of discovery composed the whole of our good Uncle Thomas' library. My education was neglected, yet I was passionately fond of reading. These volumes were my study day and night, and my familiarity with them increased that regret which I had felt, as a child, on learning that my father's dying injunction had forbidden my uncle to allow me to embark in a seafaring life.

        <p>These visions faded when I perused, for the first time, those poets whose effusions entranced my soul and lifted it to heaven. I also became a poet and for one year lived in a paradise of my own creation; I imagined that I also might obtain a niche in the temple where the names of Homer and Shakespeare are consecrated. You are well acquainted with my failure and how heavily I bore the disappointment. But just at that time I inherited the fortune of my cousin, and my thoughts were turned into the channel of their earlier bent.
      </div>
    </div>
  </div>
  <div class="dropdown-anchor" style="float: right; position: relative;">
    <img class="icon" src="img/settings.png" title="Settings" />
    <div class="dropdown" id="settings" style="width: 10em; padding: 0 30px 30px 30px;">
      <div style="text-align: center; font-weight: bold; margin-top: 15px; cursor: pointer;" data-bind="click: toggleUnit">
        <span data-bind="text: active_unit"></span> units
      </div>
      
      <div id="blend" class="slider-ctrl">
        <div class="slider-val" style="float: right;"></div>
        <div class="slider-label">Blending between zoom levels</div>
        <div class="slider" style="clear: both;"></div>
      </div>
      <div id="overzoom" class="slider-ctrl">
        <div class="slider-val" style="float: right;"></div>
        <div class="slider-label">Overzoom</div>
        <div class="slider" style="clear: both;"></div>
      </div>
      <div id="blinders" class="slider-ctrl">
        <div class="slider-val" style="float: right;"></div>
        <div class="slider-label">Blinders</div>
        <div class="slider" style="clear: both;"></div>
      </div>
    </div>
  </div>
  <div id="companion" style="float: right;">
    <img class="icon" src="img/map.png" style="cursor: pointer;" title="View on a normal map" />
  </div> 
  <div class="dropdown-anchor" style="float: right; position: relative;">
    <img class="icon" src="img/placemark.png" title="Places" />
    <div class="dropdown" data-bind="foreach: places" style="width: 15em;">
      <div class="dropdownchoice">
        <div style="cursor: pointer;" data-bind="click: select">
          <img data-bind="visible: geoloc" src="img/crosshair.png" />
          <span data-bind="text: name, style: {fontStyle: geoloc() ? 'italic' : ''}"></span>
        </div>
        <div data-bind="html: byline" style="font-size: 70%; margin-left: 1em;"></div>
      </div>
    </div>
  </div> 
  <div class="dropdown-anchor" style="float: right; position: relative;">
    <img class="icon" src="img/layers.png" title="Layers" />
    <div id="layers" class="dropdown" style="text-align: right;">
      <div data-bind="foreach: layers">
        <div class="dropdownchoice" style="white-space: nowrap;">
          <div data-bind="click: $parent.selectLayer" style="cursor: pointer;">
            <span data-bind="text: displayName, style: { fontWeight: active() ? 'bold' : '' }"></span>
            <span data-bind="if: custom() && !pending(), click: edit, clickBubble: false" style="font-size: 70%;">(edit)</span>
            <span data-bind="if: custom, click: $parent.removeLayer, clickBubble: false" style="font-size: 70%;">(remove)</span>
          </div>
          <div data-bind="template: {name: 'layer-edit', data: editContext, if: pending}"></div>
        </div>
      </div>
      <div class="dropdownchoice" data-bind="if: !pendingLayer(), click: newPendingLayer" style="cursor: pointer;">
        <img src="img/add.png" /> <i>new layer</i>
      </div>
      <div data-bind="template: {name: 'layer-edit', data: editContext, if: pendingLayer}">
      </div>
    </div>
  </div>
  <div class="dropdown-anchor" id="alerts" style="float: right; position: relative; margin-right: 15px;">
    <img class="icon" src="img/alert.png" title="Alerts" />
    <div class="dropdown" style="width: 15em;">
      <p id="err_chrome">
        <a href="http://google.com/chrome">Google Chrome</a> is recommended for the best experience.
      </p>
      <p id="err_precision">
        It appears your graphics card does not have sufficient precision for this demo to work properly.
      </p>
      <p id="err_screensize">
        This demo has been optimized to function at a maximum size of <span id="maxwidth"></span>&times;<span id="maxheight"></span>. It may malfunction at larger sizes.
      </p>
    </div>
  </div>
  <form id="search" style="float: right; margin: 4px 40px 0 20px; vertical-align: middle;">
    <input id="locsearch" placeholder="search for place&hellip;" style="width: 20em;"></input>
    <input type="submit" value="Go"></input>
  </form>
  <div>
    <span style="font-family: &quot;Open Sans Condensed&quot;, sans-serif; font-size: 150%;">MERCATOR: <b style="color: #eee;">EXTREME</b></span>
    <span style="font-family: &quot;Open Sans&quot;, sans-serif; font-size: 80%;">by <a href="http://mrgris.com">Drew Roos</a></span>
  </div>
  <div style="clear: both;"></div>
</div>

<div id="container" style="position: relative;">

<script type="text/html" id="layer-edit">
  <div class="layerform" style="text-align: left; padding: .5em; white-space: normal;">
    <table style="color: white;">
    <tr>
    <td style="vertical-align: top;">
    <div id="tile_preview" class="help" data-bind="with: layer">
      <div style="width: 256px; padding-right: 1em;" data-bind="visible: preview_status()">
        <div style="margin-bottom: 5px;"><label>preview</label></div>
        <div data-bind="if: preview_status() == 'loading'">loading...</div>
        <div data-bind="if: preview_status() == 'error'">
          <p style="font-weight: bold; color: #c22;">Could not load tile.</p>
          
          <p>This could be because:
            <ol>
              <li>the url template is incorrect
              <li>the tile server does not support cross-origin requests
              <li>everything is in fact correct, but the map layer does not publish
                a tile at zoom level 0. (Such map layers will probably not look good
                in an extreme mercator anyway &mdash; layers that provide global coverage
                are best).
            </ol>
          </p>
        </div>
        <div data-bind="if: preview_status() == 'success'">
          <img data-bind="attr: {src: preview_url}" />
          <div>does this look ok?</div>
        </div>
      </div>
    </div>
    </td>
    <td style="vertical-align: top;">
    <div style="width: 20em; float: right;">
      <form data-bind="submit: commit" style="margin: 0;">
        <div data-bind="with: layer;">
          <div><label>url template<span style="color: #c22;">*</span></label></div>
          <div><input style="width: 100%;" data-bind="value: url"></input></div>
          <div style="float: left; margin-right: 1em;">
            <div><label>name</label></div>
            <div><input style="width: 12em;" data-bind="value: name"></input></div>
          </div>
          <div style="float: left;">
            <div><label>max depth</label></div>
            <div><input style="width: 4em;" data-bind="value: max_depth"></input></div>
          </div>
      </div>
        <div style="clear: both;">
          <input type="submit" data-bind="value: commitCaption"></input>
          <button data-bind="click: cancel">cancel</button>
        </div>
      </form>
      <div class="help" style="font-size: 75%;">
        <p>
          Use the following template variables in the url:
        </p>
        
        <ul style="list-style: none;">
          <li><b>{z}</b> &mdash; zoom level
          <li><b>{x}</b> &mdash; x coordinate
          <li><b>{y}</b> &mdash; y coordinate
          <li><b>{s:...}</b> &mdash; server shard (optional), e.g.:
            <ul style="list-style: none;">
              <li>{s:1-4} &mdash; use shards 1, 2, 3, 4
              <li>{s:abc} &mdash; use shards a, b, c
            </ul>
        </ul>      
        
        <p>
          Example: <span style="white-space: nowrap;">http://tiles{s:0-3}.maps-r-us.com/blah/{z}/{x}/{y}.jpg</span>
        </p>
        
        <p>
          The tile server must support cross-origin requests in order to be
          used. (This means the server must include the <code>Access-Control-Allow-Origin: *</code>
          header in its response).
        </p>
      </div>
    </div>
    </td>
    </tr>
    </table>
  </div>
</script>

<div id="attribution" style="position: absolute; left: 0; right: 0; bottom: 0; text-align: center; pointer-events: none;"><span style="background: rgba(200, 200, 200, .7); display: inline-block; border-radius: 5px 5px 0 0; pointer-events: auto; font-size: 10px; padding: 3px;" data-bind="html: curAttr"></span></div>
<div id="poleinfo" class="poleinfo pole">
  <span class="polehdr">POLE</span><br><img class="swap" src="img/swap.png" title="Swap poles" style="margin-right: 3px;" /><span class="data"></span>
</div>
<div id="antipoleinfo" class="poleinfo antipole">
  <span class="polehdr">ANTI-POLE</span><br><span class="data"></span><img class="swap" src="img/swap.png" title="Swap poles" style="margin-left: 3px;" />
</div>
<div id="mouseinfo" class="pointerinfo">
  <span class="polehdr">POINTER</span><br>
  <div id="pos"></div>
  <span class="polehdr">FROM POLE</span><br>
  <div style="white-space: nowrap;">
    <span id="dist" style="display: inline-block; min-width: 5em; padding-right: 1em;"></span><span id="bearing"></span>
  </div>
  <hr style="background-color: #444; border: 0; height: 1px;"/>
  <div id="orient" style="float: left;"><img src="img/north.png" /></div>
  <div id="scale" style="display: inline-block; padding-left: 30px; padding-top: 6px;"><span id="label" style="font-size: 11px;"></span><div id="bar" style="height: 6px; background: rgba(0, 0, 0, .6);"></div></div>
</div>

</div>

</body>
</html>
